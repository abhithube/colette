{
  "db_name": "PostgreSQL",
  "query": "WITH\n  input_oc AS (\n    SELECT\n      *,\n      $1::UUID AS user_id\n    FROM\n      unnest(\n        $8::TEXT[],\n        $9::TIMESTAMPTZ[],\n        $10::TIMESTAMPTZ[],\n        $11::TIMESTAMPTZ[],\n        $12::TIMESTAMPTZ[]\n      ) AS oc (code, expires_at, used_at, created_at, updated_at)\n  ),\n  input_sa AS (\n    SELECT\n      *,\n      $1::UUID AS user_id\n    FROM\n      unnest(\n        $13::TEXT[],\n        $14::TEXT[],\n        $15::TIMESTAMPTZ[],\n        $16::TIMESTAMPTZ[]\n      ) AS sa (provider, sub, created_at, updated_at)\n  ),\n  upserted_user AS (\n    INSERT INTO\n      users (\n        id,\n        email,\n        verified,\n        display_name,\n        image_url,\n        created_at,\n        updated_at\n      )\n    VALUES\n      ($1, $2, $3, $4, $5, $6, $7)\n    ON CONFLICT (id) DO UPDATE\n    SET\n      email = EXCLUDED.email,\n      verified = EXCLUDED.verified,\n      display_name = EXCLUDED.display_name,\n      image_url = EXCLUDED.image_url,\n      updated_at = EXCLUDED.updated_at\n    RETURNING\n      id\n  ),\n  inserted_sa AS (\n    INSERT INTO\n      social_accounts (provider, sub, user_id, created_at, updated_at)\n    SELECT\n      provider,\n      sub,\n      user_id,\n      created_at,\n      updated_at\n    FROM\n      input_sa\n    ON CONFLICT (provider, sub) DO NOTHING\n  ),\n  inserted_oc AS (\n    INSERT INTO\n      otp_codes (\n        code,\n        expires_at,\n        used_at,\n        user_id,\n        created_at,\n        updated_at\n      )\n    SELECT\n      code,\n      expires_at,\n      used_at,\n      user_id,\n      created_at,\n      updated_at\n    FROM\n      input_oc\n    ON CONFLICT (user_id, code) DO UPDATE\n    SET\n      expires_at = EXCLUDED.expires_at,\n      used_at = EXCLUDED.used_at,\n      updated_at = EXCLUDED.updated_at\n  )\nDELETE FROM social_accounts old USING input_sa sa\nWHERE\n  NOT old.provider = sa.provider\n  AND NOT old.sub = sa.sub\n",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Uuid",
        "Text",
        "Bool",
        "Text",
        "Text",
        "Timestamptz",
        "Timestamptz",
        "TextArray",
        "TimestamptzArray",
        "TimestamptzArray",
        "TimestamptzArray",
        "TimestamptzArray",
        "TextArray",
        "TextArray",
        "TimestamptzArray",
        "TimestamptzArray"
      ]
    },
    "nullable": []
  },
  "hash": "7548383bf13e378cfd2219822ad190b6ebb1e79b05b1356bfa6769390b1ad01f"
}
