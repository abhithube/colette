{
  "db_name": "PostgreSQL",
  "query": "WITH\n  upserted_feed AS (\n    INSERT INTO\n      feeds (\n        source_url,\n        link,\n        title,\n        description,\n        refresh_interval_min,\n        status,\n        refreshed_at,\n        is_custom\n      )\n    VALUES\n      ($1, $2, $3, $4, $5, 'healthy', now(), $6)\n    ON CONFLICT (source_url) DO UPDATE\n    SET\n      link = EXCLUDED.link,\n      title = EXCLUDED.title,\n      description = EXCLUDED.description,\n      refresh_interval_min = EXCLUDED.refresh_interval_min,\n      status = EXCLUDED.status,\n      refreshed_at = EXCLUDED.refreshed_at,\n      is_custom = EXCLUDED.is_custom\n    RETURNING\n      id\n  ),\n  input_fes AS (\n    SELECT\n      *\n    FROM\n      unnest(\n        $7::TEXT[],\n        $8::TEXT[],\n        $9::TIMESTAMPTZ[],\n        $10::TEXT[],\n        $11::TEXT[],\n        $12::TEXT[]\n      ) AS t (\n        link,\n        title,\n        published_at,\n        description,\n        author,\n        thumbnail_url\n      )\n  ),\n  upserted_fes AS (\n    INSERT INTO\n      feed_entries (\n        link,\n        title,\n        published_at,\n        description,\n        author,\n        thumbnail_url,\n        feed_id\n      )\n    SELECT\n      fe.link,\n      fe.title,\n      fe.published_at,\n      fe.description,\n      fe.author,\n      fe.thumbnail_url,\n      f.id\n    FROM\n      input_fes fe\n      JOIN upserted_feed f ON TRUE\n    ON CONFLICT (feed_id, link) DO UPDATE\n    SET\n      title = EXCLUDED.title,\n      published_at = EXCLUDED.published_at,\n      description = EXCLUDED.description,\n      author = EXCLUDED.author,\n      thumbnail_url = EXCLUDED.thumbnail_url\n    RETURNING\n      id,\n      feed_id\n  ),\n  s AS (\n    SELECT\n      s.id,\n      s.feed_id\n    FROM\n      subscriptions s\n      JOIN upserted_feed f ON f.id = s.feed_id\n  )\nSELECT\n  id\nFROM\n  upserted_feed\n",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "id",
        "type_info": "Uuid"
      }
    ],
    "parameters": {
      "Left": [
        "Text",
        "Text",
        "Text",
        "Text",
        "Int4",
        "Bool",
        "TextArray",
        "TextArray",
        "TimestamptzArray",
        "TextArray",
        "TextArray",
        "TextArray"
      ]
    },
    "nullable": [
      false
    ]
  },
  "hash": "c2c19a0894fd87ed7f213ef03f3d478ab940ce2074bb2fa3a5c0eb9c1364cc07"
}
